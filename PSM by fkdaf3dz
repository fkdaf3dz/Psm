--// MATRIX POWER HUB - SECTION 1
-- Services, Variables, Island with Layered Binary Rain

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local camera = workspace.CurrentCamera

--// Characters
local binaryChars = "01"
local function getRandomBinary()
	return binaryChars:sub(math.random(1, 2), math.random(1, 2))
end

local matrixChars = "0123456789ABCDEF田由甲申甴电甶男甸甹町画甼甽甾甿畀畁畂畃畄畅畆畇畈畉畊畋界畍畎畏畐畑"
local function getRandomChar()
	return matrixChars:sub(math.random(1, #matrixChars), math.random(1, #matrixChars))
end

--// Colors
local NEON_GREEN = Color3.fromRGB(57, 255, 20)
local BLACK_BG = Color3.fromRGB(5, 5, 5)
local DARK_BG = Color3.fromRGB(10, 10, 10)

--// ScreenGui (High DisplayOrder for overlay)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MatrixPowerHub"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Global
screenGui.DisplayOrder = 100
screenGui.Parent = playerGui

--// State Variables
local isExpanded = false
local savedPanelPos = nil
local islandPosBeforeExpand = nil
local currentTab = "PSM"
local activePowerMode = "NONE"
local antiAFKEnabled = false
local minimalGFX = false
local extremeGFX = false
local lastAFKTime = 0
local fpsValue = 60

--// MAIN ORB (ZIndex 200)
local island = Instance.new("Frame")
island.Name = "CoreIsland"
island.Size = UDim2.new(0, 60, 0, 60)
island.Position = UDim2.new(0.8, 0, 0.8, 0)
island.BackgroundColor3 = BLACK_BG
island.BorderSizePixel = 0
island.ClipsDescendants = true
island.ZIndex = 200
island.Parent = screenGui

local islandCorner = Instance.new("UICorner")
islandCorner.CornerRadius = UDim.new(1, 0)
islandCorner.Parent = island

local outline = Instance.new("UIStroke")
outline.Color = NEON_GREEN
outline.Thickness = 3
outline.Parent = island

--// Background Rain (ZIndex 201)
local bgRainColumns = {}
local bgRainSpeeds = {}
for i = 1, 5 do
	local col = Instance.new("TextLabel")
	col.Size = UDim2.new(0, 10, 1, 0)
	col.Position = UDim2.new(0, 2 + (i-1)*11, 0, math.random(-40, 0))
	col.BackgroundTransparency = 1
	col.TextColor3 = NEON_GREEN
	col.TextTransparency = 0.95
	col.TextSize = 8
	col.Font = Enum.Font.Code
	col.TextXAlignment = Enum.TextXAlignment.Center
	col.TextYAlignment = Enum.TextYAlignment.Top
	col.ZIndex = 201
	col.Parent = island
	local str = ""
	for j = 1, 10 do str = str .. getRandomBinary() .. "\n" end
	col.Text = str
	table.insert(bgRainColumns, col)
	table.insert(bgRainSpeeds, math.random(8, 15) / 10)
end

--// Foreground Rain (ZIndex 203)
local islandRainColumns = {}
local islandRainSpeeds = {}
for i = 1, 4 do
	local col = Instance.new("TextLabel")
	col.Size = UDim2.new(0, 14, 1, 0)
	col.Position = UDim2.new(0, 5 + (i-1)*13, 0, math.random(-30, 0))
	col.BackgroundTransparency = 1
	col.TextColor3 = NEON_GREEN
	col.TextTransparency = 0.7
	col.TextSize = 10
	col.Font = Enum.Font.Code
	col.TextXAlignment = Enum.TextXAlignment.Center
	col.TextYAlignment = Enum.TextYAlignment.Top
	col.ZIndex = 203
	col.Parent = island
	local str = ""
	for j = 1, 8 do str = str .. getRandomBinary() .. "\n" end
	col.Text = str
	table.insert(islandRainColumns, col)
	table.insert(islandRainSpeeds, math.random(15, 25) / 10)
end

--// END OF SECTION 1
--// MATRIX POWER HUB - SECTION 2
-- Full Screen Black (Covers EVERYTHING), Panel, Tabs, Content

--// FULL SCREEN BLACK OVERLAY (ZIndex 50 - Covers entire game except UI above it)
local blackScreen = Instance.new("Frame")
blackScreen.Name = "FullBlackScreen"
blackScreen.Size = UDim2.new(2, 0, 2, 0) -- EXTRA LARGE to cover everything
blackScreen.Position = UDim2.new(-0.5, 0, -0.5, 0) -- Centered oversized
blackScreen.BackgroundColor3 = Color3.new(0, 0, 0)
blackScreen.BorderSizePixel = 0
blackScreen.ZIndex = 50
blackScreen.Visible = false
blackScreen.Parent = screenGui

--// EXPANDED PANEL (WIDER - ZIndex 60, Above black screen)
local expandedContainer = Instance.new("Frame")
expandedContainer.Name = "MatrixPanel"
expandedContainer.Size = UDim2.new(0, 450, 0, 400)
expandedContainer.BackgroundColor3 = DARK_BG
expandedContainer.BorderSizePixel = 0
expandedContainer.Visible = false
expandedContainer.ClipsDescendants = true
expandedContainer.ZIndex = 60 -- Above blackScreen (50)
expandedContainer.Parent = screenGui

local panelStroke = Instance.new("UIStroke")
panelStroke.Color = NEON_GREEN
panelStroke.Thickness = 2
panelStroke.Parent = expandedContainer

local panelCorner = Instance.new("UICorner")
panelCorner.CornerRadius = UDim.new(0, 8)
panelCorner.Parent = expandedContainer

--// Panel Matrix Rain (ZIndex 65)
local rainContainer = Instance.new("Frame")
rainContainer.Size = UDim2.new(1, 0, 1, 0)
rainContainer.BackgroundTransparency = 1
rainContainer.ZIndex = 65
rainContainer.Parent = expandedContainer

local rainColumns = {}
local rainSpeeds = {}
for i = 1, 20 do
	local col = Instance.new("TextLabel")
	col.Size = UDim2.new(0, 22, 1, 0)
	col.Position = UDim2.new(0, (i-1)*22, 0, math.random(-100, 0))
	col.BackgroundTransparency = 1
	col.TextColor3 = NEON_GREEN
	col.TextTransparency = 0.9
	col.TextSize = 13
	col.Font = Enum.Font.Code
	col.TextXAlignment = Enum.TextXAlignment.Left
	col.TextYAlignment = Enum.TextYAlignment.Top
	col.ZIndex = 65
	col.Parent = rainContainer
	local str = ""
	for j = 1, 30 do str = str .. getRandomChar() .. "\n" end
	col.Text = str
	table.insert(rainColumns, col)
	table.insert(rainSpeeds, math.random(15, 35) / 10)
end

--// HEADER (ZIndex 70)
local headerBar = Instance.new("Frame")
headerBar.Size = UDim2.new(1, 0, 0, 50)
headerBar.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
headerBar.BorderSizePixel = 0
headerBar.ZIndex = 70
headerBar.Parent = expandedContainer

local titleText = Instance.new("TextLabel")
titleText.Size = UDim2.new(0, 100, 0, 30)
titleText.Position = UDim2.new(0, 15, 0, 10)
titleText.BackgroundTransparency = 1
titleText.Text = "PSM"
titleText.TextColor3 = NEON_GREEN
titleText.TextSize = 24
titleText.Font = Enum.Font.Code
titleText.ZIndex = 71
titleText.Parent = headerBar

--// Close Button
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 35, 0, 35)
closeButton.Position = UDim2.new(1, -42, 0, 7)
closeButton.BackgroundColor3 = DARK_BG
closeButton.Text = "×"
closeButton.TextColor3 = NEON_GREEN
closeButton.TextSize = 22
closeButton.Font = Enum.Font.GothamBold
closeButton.ZIndex = 71
closeButton.Parent = headerBar

local closeStroke = Instance.new("UIStroke")
closeStroke.Color = NEON_GREEN
closeStroke.Thickness = 2
closeStroke.Parent = closeButton

local closeCorner = Instance.new("UICorner")
closeCorner.CornerRadius = UDim.new(1, 0)
closeCorner.Parent = closeButton

--// TAB BAR (Top, ZIndex 70)
local tabBar = Instance.new("Frame")
tabBar.Size = UDim2.new(1, -30, 0, 40)
tabBar.Position = UDim2.new(0, 15, 0, 55)
tabBar.BackgroundTransparency = 1
tabBar.ZIndex = 70
tabBar.Parent = expandedContainer

local psmTabBtn = Instance.new("TextButton")
psmTabBtn.Size = UDim2.new(0.33, -4, 1, 0)
psmTabBtn.Position = UDim2.new(0, 0, 0, 0)
psmTabBtn.BackgroundColor3 = NEON_GREEN
psmTabBtn.Text = "PSM"
psmTabBtn.TextColor3 = DARK_BG
psmTabBtn.TextSize = 14
psmTabBtn.Font = Enum.Font.Code
psmTabBtn.ZIndex = 71
psmTabBtn.Parent = tabBar

local otherTabBtn = Instance.new("TextButton")
otherTabBtn.Size = UDim2.new(0.33, -4, 1, 0)
otherTabBtn.Position = UDim2.new(0.33, 2, 0, 0)
otherTabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
otherTabBtn.Text = "OTHER"
otherTabBtn.TextColor3 = NEON_GREEN
otherTabBtn.TextSize = 14
otherTabBtn.Font = Enum.Font.Code
otherTabBtn.ZIndex = 71
otherTabBtn.Parent = tabBar

local infoTabBtn = Instance.new("TextButton")
infoTabBtn.Size = UDim2.new(0.33, -4, 1, 0)
infoTabBtn.Position = UDim2.new(0.66, 4, 0, 0)
infoTabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
infoTabBtn.Text = "INFO"
infoTabBtn.TextColor3 = NEON_GREEN
infoTabBtn.TextSize = 14
infoTabBtn.Font = Enum.Font.Code
infoTabBtn.ZIndex = 71
infoTabBtn.Parent = tabBar

for _, btn in ipairs({psmTabBtn, otherTabBtn, infoTabBtn}) do
	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 6)
	corner.Parent = btn
end

--// CONTENT CONTAINER (ZIndex 70)
local contentContainer = Instance.new("Frame")
contentContainer.Size = UDim2.new(1, -30, 1, -105)
contentContainer.Position = UDim2.new(0, 15, 0, 100)
contentContainer.BackgroundTransparency = 1
contentContainer.ZIndex = 70
contentContainer.Parent = expandedContainer

--// PSM Content
local psmContent = Instance.new("Frame")
psmContent.Name = "PSMContent"
psmContent.Size = UDim2.new(1, 0, 1, 0)
psmContent.BackgroundTransparency = 1
psmContent.Visible = true
psmContent.ZIndex = 71
psmContent.Parent = contentContainer

local standbyText = Instance.new("TextLabel")
standbyText.Size = UDim2.new(1, 0, 0, 30)
standbyText.Position = UDim2.new(0, 0, 0.3, 0)
standbyText.BackgroundTransparency = 1
standbyText.Text = "STANDBY_MODE_ACTIVE"
standbyText.TextColor3 = NEON_GREEN
standbyText.TextSize = 16
standbyText.Font = Enum.Font.Code
standbyText.ZIndex = 72
standbyText.Parent = psmContent

local configText = Instance.new("TextLabel")
configText.Size = UDim2.new(1, 0, 0, 20)
configText.Position = UDim2.new(0, 0, 0.3, 35)
configText.BackgroundTransparency = 1
configText.Text = "Configure power protocols..."
configText.TextColor3 = Color3.fromRGB(100, 255, 100)
configText.TextSize = 12
configText.Font = Enum.Font.Code
configText.TextTransparency = 0.5
configText.ZIndex = 72
configText.Parent = psmContent

--// OTHER Content
local otherContent = Instance.new("Frame")
otherContent.Name = "OtherContent"
otherContent.Size = UDim2.new(1, 0, 1, 0)
otherContent.BackgroundTransparency = 1
otherContent.Visible = false
otherContent.ZIndex = 71
otherContent.Parent = contentContainer

--// INFO Content
local infoContent = Instance.new("Frame")
infoContent.Name = "InfoContent"
infoContent.Size = UDim2.new(1, 0, 1, 0)
infoContent.BackgroundTransparency = 1
infoContent.Visible = false
infoContent.ZIndex = 71
infoContent.Parent = contentContainer

local thanksText = Instance.new("TextLabel")
thanksText.Size = UDim2.new(1, 0, 0, 30)
thanksText.Position = UDim2.new(0, 0, 0.35, 0)
thanksText.BackgroundTransparency = 1
thanksText.Text = "Thanks for using"
thanksText.TextColor3 = NEON_GREEN
thanksText.TextSize = 18
thanksText.Font = Enum.Font.Code
thanksText.ZIndex = 72
thanksText.Parent = infoContent

local creditText = Instance.new("TextLabel")
creditText.Size = UDim2.new(1, 0, 0, 25)
creditText.Position = UDim2.new(0, 0, 0.35, 35)
creditText.BackgroundTransparency = 1
creditText.Text = "Made by fkdaf3dz"
creditText.TextColor3 = Color3.fromRGB(100, 255, 100)
creditText.TextSize = 14
creditText.Font = Enum.Font.Code
creditText.ZIndex = 72
creditText.Parent = infoContent

local versionText = Instance.new("TextLabel")
versionText.Size = UDim2.new(1, 0, 0, 20)
versionText.Position = UDim2.new(0, 0, 0.35, 65)
versionText.BackgroundTransparency = 1
versionText.Text = "v2.0 // MATRIX EDITION"
versionText.TextColor3 = NEON_GREEN
versionText.TextSize = 12
versionText.Font = Enum.Font.Code
versionText.TextTransparency = 0.7
versionText.ZIndex = 72
versionText.Parent = infoContent

--// PANIC BUTTON (ZIndex 250 - Above everything)
local panicButton = Instance.new("TextButton")
panicButton.Size = UDim2.new(0, 45, 0, 45)
panicButton.Position = UDim2.new(1, -55, 0, 10)
panicButton.BackgroundColor3 = DARK_BG
panicButton.Text = "P"
panicButton.TextColor3 = NEON_GREEN
panicButton.TextSize = 24
panicButton.Font = Enum.Font.GothamBold
panicButton.ZIndex = 250 -- Above black screen
panicButton.Visible = false
panicButton.Parent = screenGui

local panicCorner = Instance.new("UICorner")
panicCorner.CornerRadius = UDim.new(1, 0)
panicCorner.Parent = panicButton

local panicStroke = Instance.new("UIStroke")
panicStroke.Color = NEON_GREEN
panicStroke.Thickness = 3
panicStroke.Parent = panicButton

--// FPS COUNTER (ZIndex 250)
local fpsCounter = Instance.new("TextLabel")
fpsCounter.Size = UDim2.new(0, 50, 0, 20)
fpsCounter.Position = UDim2.new(1, -60, 0, 10)
fpsCounter.BackgroundTransparency = 1
fpsCounter.Text = "60"
fpsCounter.TextColor3 = NEON_GREEN
fpsCounter.TextSize = 14
fpsCounter.Font = Enum.Font.Code
fpsCounter.TextXAlignment = Enum.TextXAlignment.Right
fpsCounter.ZIndex = 250
fpsCounter.Parent = screenGui

--// AUTO-DETECT NOTIFICATION (ZIndex 250)
local autoNotify = Instance.new("Frame")
autoNotify.Size = UDim2.new(0, 280, 0, 45)
autoNotify.Position = UDim2.new(0, 10, 1, 50)
autoNotify.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
autoNotify.BorderSizePixel = 0
autoNotify.ZIndex = 250
autoNotify.Visible = false
autoNotify.Parent = screenGui

local notifyCorner = Instance.new("UICorner")
notifyCorner.CornerRadius = UDim.new(0, 6)
notifyCorner.Parent = autoNotify

local notifyStroke = Instance.new("UIStroke")
notifyStroke.Color = NEON_GREEN
notifyStroke.Thickness = 2
notifyStroke.Parent = autoNotify

local notifyText = Instance.new("TextLabel")
notifyText.Size = UDim2.new(1, -10, 1, 0)
notifyText.Position = UDim2.new(0, 5, 0, 0)
notifyText.BackgroundTransparency = 1
notifyText.Text = "Low FPS Detected - Enable Power Save?"
notifyText.TextColor3 = NEON_GREEN
notifyText.TextSize = 12
notifyText.Font = Enum.Font.Code
notifyText.ZIndex = 251
notifyText.Parent = autoNotify

--// END OF SECTION 2
--// MATRIX POWER HUB - SECTION 3
--// MATRIX POWER HUB - SECTION 4
-- Functions, Graphics (EFFICIENT + GRAY MODE), FPS, Rain Animation

--// Expand/Collapse
function expandIsland()
	isExpanded = true
	islandPosBeforeExpand = island.Position
	
	if not savedPanelPos then
		local screenSize = workspace.CurrentCamera.ViewportSize
		local centerX = (screenSize.X - 450) / 2
		local centerY = (screenSize.Y - 400) / 2
		expandedContainer.Position = UDim2.new(0, centerX, 0, centerY)
	else
		expandedContainer.Position = savedPanelPos
	end
	
	expandedContainer.Visible = true
end

function collapseIsland()
	isExpanded = false
	expandedContainer.Visible = false
	if islandPosBeforeExpand then
		island.Position = islandPosBeforeExpand
	end
end

--// EFFICIENT Power Save Functions with GRAY MODE
local processedObjects = {}
local originalProperties = {}

--// EXTREME GRAPHICS - Everything GRAY and textureless for max performance
function setExtremeGraphics(enabled)
	if enabled then
		-- Settings that actually reduce CPU/GPU load
		pcall(function() 
			settings().Rendering.QualityLevel = 1 
			settings().Rendering.EnableFRM = false
		end)
		
		-- Aggressive lighting reduction
		Lighting.GlobalShadows = false
		Lighting.Brightness = 0.05 -- Almost black
		Lighting.Ambient = Color3.new(0.2, 0.2, 0.2) -- Dark gray
		Lighting.OutdoorAmbient = Color3.new(0.2, 0.2, 0.2)
		Lighting.FogEnd = 30 -- Very short render distance
		Lighting.FogColor = Color3.new(0.1, 0.1, 0.1) -- Gray fog
		
		-- Camera settings
		camera.FieldOfView = 50 -- Lower FOV = less rendering
		
		-- Process workspace in CHUNKS to prevent overheating
		task.spawn(function()
			local descendants = workspace:GetDescendants()
			local batchSize = 50
			local waitTime = 0.05
			
			for i = 1, #descendants do
				local v = descendants[i]
				if v then
					-- Store original properties
					if not originalProperties[v] then
						originalProperties[v] = {}
					end
					
					-- GRAY MODE: Make all parts gray and plastic
					if v:IsA("BasePart") then
						originalProperties[v].Material = v.Material
						originalProperties[v].Color = v.Color
						v.Material = Enum.Material.SmoothPlastic
						v.Color = Color3.fromRGB(100, 100, 100) -- GRAY
						
						-- Special handling for MeshParts
						if v:IsA("MeshPart") then
							originalProperties[v].RenderFidelity = v.RenderFidelity
							originalProperties[v].TextureID = v.TextureID
							v.RenderFidelity = Enum.RenderFidelity.Performance
							v.TextureID = "" -- Remove mesh textures
						end
					end
					
					-- Remove ALL textures/decals completely
					if v:IsA("Texture") or v:IsA("Decal") then
						originalProperties[v].Transparency = v.Transparency
						originalProperties[v].Texture = v.Texture
						v.Transparency = 1
						v.Texture = "" -- Clear texture data
					end
					
					-- Remove SurfaceGuis and BillboardGuis
					if v:IsA("SurfaceGui") or v:IsA("BillboardGui") or v:IsA("ScreenGui") then
						if v.Parent ~= screenGui then -- Don't break our own GUI
							originalProperties[v].Enabled = v.Enabled
							v.Enabled = false
						end
					end
					
					-- Disable effects
					if v:IsA("ParticleEmitter") then
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					elseif v:IsA("Beam") or v:IsA("Trail") then
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					elseif v:IsA("PointLight") or v:IsA("SpotLight") or v:IsA("SurfaceLight") then
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					elseif v:IsA("Fire") or v:IsA("Smoke") or v:IsA("Sparkles") then
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					end
				end
				
				-- Yield to prevent overheating
				if i % batchSize == 0 then
					task.wait(waitTime)
				end
			end
		end)
		
		-- Reduce character detail
		pcall(function()
			local character = player.Character
			if character then
				for _, part in ipairs(character:GetDescendants()) do
					if part:IsA("BasePart") then
						part.Material = Enum.Material.SmoothPlastic
						part.Color = Color3.fromRGB(100, 100, 100) -- Gray character too
					end
					if part:IsA("Decal") or part:IsA("Texture") then
						part.Transparency = 1
					end
					if part:IsA("ParticleEmitter") then
						part.Enabled = false
					end
				end
			end
		end)
		
	else
		-- RESTORE original settings
		pcall(function() 
			settings().Rendering.QualityLevel = 10 
			settings().Rendering.EnableFRM = true
		end)
		
		Lighting.GlobalShadows = true
		Lighting.Brightness = 1
		Lighting.Ambient = Color3.fromRGB(127, 127, 127)
		Lighting.OutdoorAmbient = Color3.fromRGB(127, 127, 127)
		Lighting.FogEnd = 10000
		Lighting.FogColor = Color3.new(0.75, 0.75, 0.75)
		camera.FieldOfView = 70
		
		-- Restore workspace properties in chunks
		task.spawn(function()
			local count = 0
			for obj, props in pairs(originalProperties) do
				if obj and obj.Parent then
					pcall(function()
						-- Restore material and color
						if props.Material then obj.Material = props.Material end
						if props.Color then obj.Color = props.Color end
						if props.TextureID then obj.TextureID = props.TextureID end
						if props.RenderFidelity then obj.RenderFidelity = props.RenderFidelity end
						if props.Transparency then obj.Transparency = props.Transparency end
						if props.Texture then obj.Texture = props.Texture end
						if props.Enabled ~= nil then obj.Enabled = props.Enabled end
					end)
				end
				count = count + 1
				if count % 100 == 0 then
					task.wait(0.03)
				end
			end
			originalProperties = {}
		end)
	end
end

--// MINIMAL GRAPHICS - Lighter version (keeps colors, removes effects)
function setMinimalGraphics(enabled)
	if enabled then
		pcall(function() settings().Rendering.QualityLevel = 1 end)
		
		Lighting.GlobalShadows = false
		Lighting.Brightness = 0.5
		Lighting.FogEnd = 100
		
		task.spawn(function()
			local descendants = workspace:GetDescendants()
			for i = 1, #descendants do
				local v = descendants[i]
				if v then
					if v:IsA("ParticleEmitter") then
						if not originalProperties[v] then originalProperties[v] = {} end
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					elseif v:IsA("PointLight") or v:IsA("SpotLight") then
						if not originalProperties[v] then originalProperties[v] = {} end
						originalProperties[v].Enabled = v.Enabled
						v.Enabled = false
					elseif v:IsA("Decal") or v:IsA("Texture") then
						if not originalProperties[v] then originalProperties[v] = {} end
						originalProperties[v].Transparency = v.Transparency
						v.Transparency = 1 -- Hide textures but don't clear them
					end
				end
				if i % 100 == 0 then task.wait(0.03) end
			end
		end)
	else
		if not extremeGFX then
			pcall(function() settings().Rendering.QualityLevel = 10 end)
			Lighting.GlobalShadows = true
			Lighting.Brightness = 1
			Lighting.FogEnd = 10000
			
			task.spawn(function()
				local count = 0
				for obj, props in pairs(originalProperties) do
					if obj and obj.Parent then
						pcall(function()
							if props.Enabled ~= nil then obj.Enabled = props.Enabled end
							if props.Transparency then obj.Transparency = props.Transparency end
						end)
					end
					count = count + 1
					if count % 100 == 0 then task.wait(0.03) end
				end
			end)
		end
	end
end

--// Panic Button
panicButton.MouseButton1Click:Connect(function()
	activePowerMode = "NONE"
	antiAFKEnabled = false
	minimalGFX = false
	extremeGFX = false
	blackScreen.Visible = false
	panicButton.Visible = false
	
	animateToggle(normalToggle, false)
	animateToggle(maxToggle, false)
	animateToggle(antiAfkToggle, false)
	animateToggle(minGfxToggle, false)
	animateToggle(extremeToggle, false)
	
	setExtremeGraphics(false)
	setMinimalGraphics(false)
end)

--// FPS & Auto-Detect
local lastCalcTime = tick()
local frameAccumulator = 0
local notifyShown = false

RunService.Heartbeat:Connect(function()
	frameAccumulator = frameAccumulator + 1
	local now = tick()
	
	if now - lastCalcTime >= 0.5 then
		fpsValue = math.floor(frameAccumulator / (now - lastCalcTime))
		fpsCounter.Text = tostring(fpsValue)
		frameAccumulator = 0
		lastCalcTime = now
		
		if fpsValue < 25 and not notifyShown and activePowerMode == "NONE" and now > 5 then
			notifyShown = true
			autoNotify.Visible = true
			TweenService:Create(autoNotify, TweenInfo.new(0.5), {Position = UDim2.new(0, 10, 1, -55)}):Play()
			task.delay(2.5, function()
				TweenService:Create(autoNotify, TweenInfo.new(0.5), {Position = UDim2.new(0, 10, 1, 50)}):Play()
				task.wait(0.5)
				autoNotify.Visible = false
				task.wait(10)
				notifyShown = false
			end)
		end
	end
	
	--// ANTI-AFK - Every 5 minutes with 0.2 camera movement
	if antiAFKEnabled and (now - lastAFKTime >= 300) then
		pcall(function()
			camera.CFrame = camera.CFrame * CFrame.Angles(0, math.rad(0.2), 0)
			task.wait(0.1)
			camera.CFrame = camera.CFrame * CFrame.Angles(0, math.rad(-0.2), 0)
		end)
		lastAFKTime = now
	end
end)

--// Panic Pulse
task.spawn(function()
	while true do
		if panicButton.Visible then
			TweenService:Create(panicButton, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), 
				{BackgroundColor3 = Color3.fromRGB(40, 100, 40)}):Play()
			task.wait(1)
			TweenService:Create(panicButton, TweenInfo.new(1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), 
				{BackgroundColor3 = DARK_BG}):Play()
			task.wait(1)
		else
			task.wait(0.5)
		end
	end
end)

--// Rain Animation (Optimized)
RunService.RenderStepped:Connect(function()
	-- Panel Rain
	if expandedContainer.Visible then
		for i = 1, #rainColumns do
			local col = rainColumns[i]
			local y = col.Position.Y.Offset + rainSpeeds[i]
			if y > 20 then
				y = -150
				local str = ""
				for j = 1, 30 do str = str .. getRandomChar() .. "\n" end
				col.Text = str
			end
			col.Position = UDim2.new(0, (i-1)*22, 0, y)
		end
	end
	
	-- Island Rain
	if island.Visible then
		for i = 1, #bgRainColumns do
			local col = bgRainColumns[i]
			local y = col.Position.Y.Offset + bgRainSpeeds[i]
			if y > 10 then
				y = -50
				local str = ""
				for j = 1, 10 do str = str .. getRandomBinary() .. "\n" end
				col.Text = str
			end
			col.Position = UDim2.new(0, 2 + (i-1)*11, 0, y)
		end
		
		for i = 1, #islandRainColumns do
			local col = islandRainColumns[i]
			local y = col.Position.Y.Offset + islandRainSpeeds[i]
			if y > 15 then
				y = -45
				local str = ""
				for j = 1, 8 do str = str .. getRandomBinary() .. "\n" end
				col.Text = str
			end
			col.Position = UDim2.new(0, 5 + (i-1)*13, 0, y)
		end
	end
end)

print("PSM Matrix Hub v2.0 - Gray Mode Enabled")
--// END OF SECTION 4
